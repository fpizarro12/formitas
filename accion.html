<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Procesando...</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; background-color: #f0f2f5; }
        p { font-size: 1.2rem; color: #333; font-weight: bold; }
    </style>
</head>
<body>
    <p id="message">Procesando su solicitud, por favor espere...</p>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // ---- IMPORTANTE: Pega aquí la URL de tu función ----
        var functionUrl = 'https://us-central1-pedidos-formitas.cloudfunctions.net/realizarAccion'; 
        // ----------------------------------------------------

        var params = {};
        if (window.location.search) {
            window.location.search.substring(1).split('&').forEach(function(pair) {
                var parts = pair.split('=');
                if(parts.length === 2) {
                    params[decodeURIComponent(parts[0])] = decodeURIComponent(parts[1]);
                }
            });
        }

        var returnUrl = params['returnUrl'];
        if (!returnUrl) {
            document.getElementById('message').innerText = 'Error: No se encontró la URL de retorno.';
            return;
        }

        // Construir la URL completa de la función con sus parámetros
        var fullUrl = functionUrl +
            '?id=' + params['id'] +
            '&action=' + params['action'] +
            (params['status'] ? '&status=' + params['status'] : '');

        // Usamos un truco para hacer la petición sin esperar respuesta, creando una imagen en memoria.
        var img = new Image();
        img.src = fullUrl;

        // Damos tiempo a que la petición se envíe y luego redirigimos.
        setTimeout(function() {
            window.location.href = returnUrl;
        }, 1500); // 1.5 segundos de espera
    });
    </script>
</body>
</html>