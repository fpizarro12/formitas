<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados de Pedidos - Formitas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
        .font-formitas { font-family: 'Comic Neue', cursive; }
        .version-subtitle { font-size: 1rem; color: #4b5563; font-weight: 600; margin-top: 0.25rem; }
        .excel-table { border-collapse: collapse; width: 100%; font-size: 0.875rem; }
        .excel-table th, .excel-table td { border: 1px solid #e5e7eb; padding: 0.75rem 1rem; text-align: left; vertical-align: middle; }
        .excel-table th { background-color: #f9fafb; font-weight: 600; text-transform: uppercase; font-size: 0.75rem; color: #374151; }
        .excel-table tr:nth-child(even) td { background-color: #f9fafb; }
        .status-select { display: block; width: 100%; border-radius: 0.375rem; border: 1px solid #d1d5db; padding: 0.25rem 0.5rem; background-color: white; cursor: pointer; }
        .btn-secondary { background-color: #e5e7eb; color: #1f2937; font-weight: 600; padding: 0.5rem 1rem; border-radius: 0.5rem; border: 1px solid #6b7280; transition: background-color 0.2s; }
        .btn-secondary:hover { background-color: #d1d5db; }
        .btn-success { background-color: #16a34a; color: white; font-weight: 600; padding: 0.5rem 1rem; border-radius: 0.5rem; border: 1px solid #14532d; transition: background-color 0.2s; }
        .btn-success:hover { background-color: #15803d; }
        .filter-header { position: relative; cursor: pointer; display: flex; align-items: center; justify-content: space-between; }
        .filter-icon { width: 1rem; height: 1rem; margin-left: 0.5rem; color: #9ca3af; transition: color 0.2s; }
        .filter-header:hover .filter-icon { color: #374151; }
        .filter-icon.active { color: #2563eb; }
        .filter-dropdown { position: absolute; top: 100%; left: 0; background-color: white; border: 1px solid #d1d5db; border-radius: 0.5rem; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 10; max-height: 200px; overflow-y: auto; min-width: 150px; }
        .filter-dropdown-item { padding: 0.5rem 1rem; cursor: pointer; }
        .filter-dropdown-item:hover { background-color: #f3f4f6; }
    </style>
</head>
<body class="py-12">
    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-8">
            <h1 class="font-formitas text-5xl font-bold text-red-500">Formitas</h1>
            <h2 id="main-title" class="text-3xl font-bold text-gray-700 mt-2">Pedidos</h2>
            <p class="version-subtitle">V.1.01.05</p>
            <div class="flex justify-center items-center space-x-4 mt-4">
                <button id="new-search-button" class="btn-secondary">Nueva Búsqueda</button>
                <button id="export-excel-button" class="btn-success">Baja a Excel</button>
            </div>
        </header>
        <main id="results-container">
            <div class="bg-white rounded-xl shadow-lg overflow-x-auto">
                <table class="excel-table">
                    <thead>
                        <tr>
                            <th>Fecha</th><th>Veterinaria</th><th id="modelo-header"><div class="filter-header"><span>Modelo (Forma)</span><svg class="filter-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg><div id="modelo-filter-dropdown" class="filter-dropdown hidden"></div></div></th><th id="color-header"><div class="filter-header"><span>Color</span><svg class="filter-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg><div id="color-filter-dropdown" class="filter-dropdown hidden"></div></div></th><th>Mascota</th><th>Telefono</th><th>Atrás (Linea Extra)</th><th>Observaciones</th><th>Estado</th>
                        </tr>
                    </thead>
                    <tbody id="orders-table-body"></tbody>
                </table>
            </div>
        </main>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, query, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = { /* config aquí */ };
        const APP_ID = 'pet-tags-split-app';
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const dom = { /* referencias a elementos */ };

        async function loadAndFilterOrders() {
            const params = new URLSearchParams(window.location.search);
            const filters = {
                startDate: params.get('startDate'),
                endDate: params.get('endDate'),
                // ...
            };

            const q = query(collection(db, `/artifacts/${APP_ID}/public/data/pedidos`));
            const querySnapshot = await getDocs(q);

            let allOrders = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

            const filtered = allOrders.filter(order => {
                const orderDate = order.timestamp ? new Date(order.timestamp.seconds * 1000) : null;
                if (!orderDate) return false;

                if (filters.startDate) {
                    const startDateOnly = new Date(filters.startDate);
                    const orderDateOnly = new Date(orderDate);
                    startDateOnly.setHours(0, 0, 0, 0);
                    orderDateOnly.setHours(0, 0, 0, 0);
                    if (orderDateOnly < startDateOnly) return false;
                }
                if (filters.endDate) {
                    const endDateOnly = new Date(filters.endDate);
                    const orderDateOnly = new Date(orderDate);
                    endDateOnly.setHours(0, 0, 0, 0);
                    orderDateOnly.setHours(0, 0, 0, 0);
                    if (orderDateOnly > endDateOnly) return false;
                }

                return true;
            });

            // render(filtered)
        }

        loadAndFilterOrders();
    </script>
</body>
</html>
