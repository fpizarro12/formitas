<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Configuración de Mensajes - Formitas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SDKs de Firebase v8 -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f0f2f5; }
        .font-formitas { font-family: 'Comic Neue', cursive; }
        .btn { font-weight: 600; padding: 0.6rem 1.5rem; border-radius: 0.5rem; transition: background-color 0.2s; cursor: pointer; border: none; }
        .btn-primary { background-color: #16a34a; color: white; border: 2px solid #14532d; }
        .btn-primary:hover { background-color: #15803d; }
        .form-textarea { width: 100%; border: 1px solid #d1d5db; border-radius: 0.375rem; padding: 0.75rem; min-height: 150px; }
        .toggle-label { display: flex; align-items: center; cursor: pointer; }
        .toggle-checkbox { width: 1.25rem; height: 1.25rem; margin-right: 0.5rem; }
    </style>
</head>
<body class="py-12">

    <div class="container mx-auto p-4 md:p-8 max-w-2xl">
        <header class="text-center mb-8">
            <h1 class="font-formitas text-5xl font-bold text-red-500">Formitas</h1>
            <h2 class="text-3xl font-bold text-gray-700 mt-2">Mensajes del Sistema</h2>
        </header>

        <div class="bg-white p-8 rounded-xl shadow-lg mb-8">
            <form id="message-form" class="space-y-6">
                <div>
                    <label for="message-text" class="block text-sm font-medium text-gray-700 mb-2">Mensaje para las Veterinarias</label>
                    <textarea id="message-text" class="form-textarea" placeholder="Escriba aquí el mensaje importante (ej: Vacaciones, cambios de horario, etc.)..."></textarea>
                </div>
                
                <div class="flex items-center justify-between bg-gray-50 p-4 rounded-lg border border-gray-200">
                    <span class="text-gray-700 font-medium">Estado del Mensaje:</span>
                    <label class="toggle-label">
                        <input type="checkbox" id="message-active" class="toggle-checkbox">
                        <span id="status-text" class="text-sm font-bold text-gray-500">Inactivo</span>
                    </label>
                </div>

                <div class="pt-4 text-center">
                    <button type="submit" id="save-button" class="btn btn-primary w-full md:w-auto">Guardar Configuración</button>
                </div>
            </form>
        </div>
        
        <div id="status-message" class="text-center font-bold mt-4" style="min-height: 1.5rem;"></div>
    </div>

    <script>
    window.onload = function() {
        var firebaseConfig = { apiKey: "AIzaSyCM7apkWZs6RiNdu5Y4GCtJxRr7Go2lhiQ", authDomain: "pedidos-formitas.firebaseapp.com", projectId: "pedidos-formitas", storageBucket: "pedidos-formitas.appspot.com", messagingSenderId: "745379401007", appId: "1:745379401007:web:c41a2d3d33f4b8582365da" };
        var APP_ID = 'pet-tags-split-app';
        
        var db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
        } catch (error) {
            console.error("Error Firebase:", error);
        }

        var messageText = document.getElementById('message-text');
        var messageActive = document.getElementById('message-active');
        var statusText = document.getElementById('status-text');
        var saveButton = document.getElementById('save-button');
        var statusMessageDiv = document.getElementById('status-message');
        var messageDocRef = db.collection('/artifacts/' + APP_ID + '/public/data/mensajes').doc('global');

        function updateStatusLabel() {
            if (messageActive.checked) {
                statusText.textContent = "ACTIVO (Visible)";
                statusText.className = "text-sm font-bold text-green-600";
            } else {
                statusText.textContent = "Inactivo (Oculto)";
                statusText.className = "text-sm font-bold text-gray-500";
            }
        }

        // Cargar datos existentes
        messageDocRef.get().then(function(doc) {
            if (doc.exists) {
                var data = doc.data();
                messageText.value = data.texto || '';
                messageActive.checked = data.activo || false;
                updateStatusLabel();
            }
        }).catch(function(error) {
            console.error("Error al cargar mensaje:", error);
        });

        messageActive.addEventListener('change', updateStatusLabel);

        document.getElementById('message-form').addEventListener('submit', function(e) {
            e.preventDefault();
            saveButton.disabled = true;
            saveButton.textContent = "Guardando...";

            var dataToSave = {
                texto: messageText.value,
                activo: messageActive.checked,
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };

            messageDocRef.set(dataToSave)
                .then(function() {
                    statusMessageDiv.textContent = "Mensaje actualizado correctamente.";
                    statusMessageDiv.style.color = "green";
                    setTimeout(function() { statusMessageDiv.textContent = ""; }, 3000);
                })
                .catch(function(error) {
                    console.error("Error al guardar:", error);
                    statusMessageDiv.textContent = "Error al guardar cambios.";
                    statusMessageDiv.style.color = "red";
                })
                .finally(function() {
                    saveButton.disabled = false;
                    saveButton.textContent = "Guardar Configuración";
                });
        });
    };
    </script>
</body>
</html>
